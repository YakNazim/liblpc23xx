<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>liblpc23xx: usbcontrol.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_cb18626a3ad63082fb4a3db0fa80b6b4.html">lpc23xx-usb</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>usbcontrol.c File Reference</h1>  </div>
</div>
<div class="contents">
<code>#include &quot;<a class="el" href="lpc23xx-types_8h_source.html">lpc23xx-types.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lpc23xx-debug_8h_source.html">lpc23xx-debug.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lpc23xx-util_8h_source.html">lpc23xx-util.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="printf-lpc_8h_source.html">printf-lpc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="usbstruct_8h_source.html">usbstruct.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="usbapi_8h_source.html">usbapi.h</a>&quot;</code><br/>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbcontrol_8c.html#a5e88408279bd004961a1fbcf4a20cc0c">MAX_CONTROL_SIZE</a>&nbsp;&nbsp;&nbsp;128</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbcontrol_8c.html#a15136a2bda6efe224bf6d43d4849165a">MAX_REQ_HANDLERS</a>&nbsp;&nbsp;&nbsp;4</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lpc23xx-types_8h.html#a3e5b8192e7d9ffaf3542f1210aec18dd">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbcontrol_8c.html#afbf75804e64de3aa723f84505f743291">_HandleRequest</a> (<a class="el" href="structTSetupPacket.html">TSetupPacket</a> *pSetup, int *piLen, uint8_t **ppbData)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbcontrol_8c.html#a6a9a92bc76638d84116a616938441db0">StallControlPipe</a> (uint8_t bEPStat)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbcontrol_8c.html#a3460be1da9ea259366a0699698047f2d">DataIn</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbcontrol_8c.html#a9bd3d3ea6200776440867dcb423d94b9">USBHandleControlTransfer</a> (uint8_t bEP, uint8_t bEPStat)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbcontrol_8c.html#ac5a4cfc0dc8c7f71fb348bc7b159cf9d">USBRegisterRequestHandler</a> (int iType, <a class="el" href="usbapi_8h.html#a06756e9ddbfbf73a686f8e536e352f84">TFnHandleRequest</a> *pfnHandler, uint8_t *pbDataStore)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structTSetupPacket.html">TSetupPacket</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbcontrol_8c.html#a23d410b63af4d26b960f91fe5da724ad">Setup</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint8_t *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbcontrol_8c.html#a899b002c86dcf8c2d5dd585f863ae78b">pbData</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbcontrol_8c.html#ad873159e80feb9e3e7f7f924902bc281">iResidue</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbcontrol_8c.html#a5107428870ffb7eeaedd654d10e86916">iLen</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="usbapi_8h.html#a06756e9ddbfbf73a686f8e536e352f84">TFnHandleRequest</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbcontrol_8c.html#a3734a892a985e2d17422e6e13f9c89df">apfnReqHandlers</a> [4] = {NULL, NULL, NULL, NULL}</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint8_t *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbcontrol_8c.html#a45623ec897a78dae13be581527b5b24e">apbDataStore</a> [4] = {NULL, NULL, NULL, NULL}</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Control transfer handler.</p>
<p>This module handles control transfers and is normally installed on the endpoint 0 callback.</p>
<p>Control transfers can be of the following type: 0 Standard; 1 Class; 2 Vendor; 3 Reserved.</p>
<p>A callback can be installed for each of these control transfers using USBRegisterRequestHandler. When an OUT request arrives, data is collected in the data store provided with the USBRegisterRequestHandler call. When the transfer is done, the callback is called. When an IN request arrives, the callback is called immediately to either put the control transfer data in the data store, or to get a pointer to control transfer data. The data is then packetised and sent to the host. </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a5e88408279bd004961a1fbcf4a20cc0c"></a><!-- doxytag: member="usbcontrol.c::MAX_CONTROL_SIZE" ref="a5e88408279bd004961a1fbcf4a20cc0c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_CONTROL_SIZE&nbsp;&nbsp;&nbsp;128</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>maximum total size of control transfer data </p>

</div>
</div>
<a class="anchor" id="a15136a2bda6efe224bf6d43d4849165a"></a><!-- doxytag: member="usbcontrol.c::MAX_REQ_HANDLERS" ref="a15136a2bda6efe224bf6d43d4849165a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_REQ_HANDLERS&nbsp;&nbsp;&nbsp;4</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>standard, class, vendor, reserved </p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="afbf75804e64de3aa723f84505f743291"></a><!-- doxytag: member="usbcontrol.c::_HandleRequest" ref="afbf75804e64de3aa723f84505f743291" args="(TSetupPacket *pSetup, int *piLen, uint8_t **ppbData)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="lpc23xx-types_8h.html#a3e5b8192e7d9ffaf3542f1210aec18dd">BOOL</a> _HandleRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTSetupPacket.html">TSetupPacket</a> *&nbsp;</td>
          <td class="paramname"> <em>pSetup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>piLen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t **&nbsp;</td>
          <td class="paramname"> <em>ppbData</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Local function to handle a request by calling one of the installed request handlers.</p>
<p>In case of data going from host to device, the data is at *ppbData. In case of data going from device to host, the handler can either choose to write its data at *ppbData or update the data pointer.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pSetup</em>&nbsp;</td><td>The setup packet </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>*piLen</em>&nbsp;</td><td>Pointer to data length </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>ppbData</em>&nbsp;</td><td>Data buffer.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>TRUE if the request was handles successfully </dd></dl>

</div>
</div>
<a class="anchor" id="a6a9a92bc76638d84116a616938441db0"></a><!-- doxytag: member="usbcontrol.c::StallControlPipe" ref="a6a9a92bc76638d84116a616938441db0" args="(uint8_t bEPStat)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void StallControlPipe </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bEPStat</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Local function to stall the control endpoint</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bEPStat</em>&nbsp;</td><td>Endpoint status </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a3460be1da9ea259366a0699698047f2d"></a><!-- doxytag: member="usbcontrol.c::DataIn" ref="a3460be1da9ea259366a0699698047f2d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void DataIn </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sends next chunk of data (possibly 0 bytes) to host </p>

</div>
</div>
<a class="anchor" id="a9bd3d3ea6200776440867dcb423d94b9"></a><!-- doxytag: member="usbcontrol.c::USBHandleControlTransfer" ref="a9bd3d3ea6200776440867dcb423d94b9" args="(uint8_t bEP, uint8_t bEPStat)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBHandleControlTransfer </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bEP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bEPStat</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handles IN/OUT transfers on EP0</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bEP</em>&nbsp;</td><td>Endpoint address </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bEPStat</em>&nbsp;</td><td>Endpoint status </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ac5a4cfc0dc8c7f71fb348bc7b159cf9d"></a><!-- doxytag: member="usbcontrol.c::USBRegisterRequestHandler" ref="ac5a4cfc0dc8c7f71fb348bc7b159cf9d" args="(int iType, TFnHandleRequest *pfnHandler, uint8_t *pbDataStore)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBRegisterRequestHandler </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>iType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="usbapi_8h.html#a06756e9ddbfbf73a686f8e536e352f84">TFnHandleRequest</a> *&nbsp;</td>
          <td class="paramname"> <em>pfnHandler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>pbDataStore</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Registers a callback for handling requests</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>iType</em>&nbsp;</td><td>Type of request, e.g. REQTYPE_TYPE_STANDARD </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>*pfnHandler</em>&nbsp;</td><td>Callback function pointer </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>*pbDataStore</em>&nbsp;</td><td>Data storage area for this type of request </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a23d410b63af4d26b960f91fe5da724ad"></a><!-- doxytag: member="usbcontrol.c::Setup" ref="a23d410b63af4d26b960f91fe5da724ad" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structTSetupPacket.html">TSetupPacket</a> <a class="el" href="usbcontrol_8c.html#a23d410b63af4d26b960f91fe5da724ad">Setup</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>setup packet </p>

</div>
</div>
<a class="anchor" id="a899b002c86dcf8c2d5dd585f863ae78b"></a><!-- doxytag: member="usbcontrol.c::pbData" ref="a899b002c86dcf8c2d5dd585f863ae78b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t* <a class="el" href="usbcontrol_8c.html#a899b002c86dcf8c2d5dd585f863ae78b">pbData</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>pointer to data buffer </p>

</div>
</div>
<a class="anchor" id="ad873159e80feb9e3e7f7f924902bc281"></a><!-- doxytag: member="usbcontrol.c::iResidue" ref="ad873159e80feb9e3e7f7f924902bc281" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="usbcontrol_8c.html#ad873159e80feb9e3e7f7f924902bc281">iResidue</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>remaining bytes in buffer </p>

</div>
</div>
<a class="anchor" id="a5107428870ffb7eeaedd654d10e86916"></a><!-- doxytag: member="usbcontrol.c::iLen" ref="a5107428870ffb7eeaedd654d10e86916" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="usbcontrol_8c.html#a5107428870ffb7eeaedd654d10e86916">iLen</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>total length of control transfer </p>

</div>
</div>
<a class="anchor" id="a3734a892a985e2d17422e6e13f9c89df"></a><!-- doxytag: member="usbcontrol.c::apfnReqHandlers" ref="a3734a892a985e2d17422e6e13f9c89df" args="[4]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="usbapi_8h.html#a06756e9ddbfbf73a686f8e536e352f84">TFnHandleRequest</a>* <a class="el" href="usbcontrol_8c.html#a3734a892a985e2d17422e6e13f9c89df">apfnReqHandlers</a>[4] = {NULL, NULL, NULL, NULL}<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Array of installed request handler callbacks </p>

</div>
</div>
<a class="anchor" id="a45623ec897a78dae13be581527b5b24e"></a><!-- doxytag: member="usbcontrol.c::apbDataStore" ref="a45623ec897a78dae13be581527b5b24e" args="[4]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t* <a class="el" href="usbcontrol_8c.html#a45623ec897a78dae13be581527b5b24e">apbDataStore</a>[4] = {NULL, NULL, NULL, NULL}<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Array of installed request data pointers </p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Fri Aug 26 2011 12:39:57 for liblpc23xx by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
