<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>liblpc23xx: usbhw_lpc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_cb18626a3ad63082fb4a3db0fa80b6b4.html">lpc23xx-usb</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>usbhw_lpc.c File Reference</h1>  </div>
</div>
<div class="contents">
<code>#include &quot;<a class="el" href="lpc23xx_8h_source.html">lpc23xx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lpc23xx-types_8h_source.html">lpc23xx-types.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lpc23xx-debug_8h_source.html">lpc23xx-debug.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="printf-lpc_8h_source.html">printf-lpc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="usbhw__lpc_8h_source.html">usbhw_lpc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="usbapi_8h_source.html">usbapi.h</a>&quot;</code><br/>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a3eaf046a4008f5e987d369949ada44bf">DEBUG_LED_INIT</a>(x)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#ae0c331b0f232393b6ac7b5c4194cf1c7">DEBUG_LED_ON</a>(x)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a73b1055927a84310c708efeb0165480b">DEBUG_LED_OFF</a>(x)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a00ae1ba9be3cc10583f6d81776b9fd4e">EP2IDX</a>(bEP)&nbsp;&nbsp;&nbsp;((((bEP)&amp;0xF)&lt;&lt;1)|(((bEP)&amp;0x80)&gt;&gt;7))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a998d2a16b853abfa50f30cc0c53ddd38">IDX2EP</a>(idx)&nbsp;&nbsp;&nbsp;((((idx)&lt;&lt;7)&amp;0x80)|(((idx)&gt;&gt;1)&amp;0xF))</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a9cd85ad2f851492776a4ea5b67e8a9b9">Wait4DevInt</a> (uint32_t dwIntr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#af661719c467f8b57cd220e6344e9ee33">USBHwCmd</a> (uint8_t bCmd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a56473a98d7755138ab78b81ea95c1070">USBHwCmdWrite</a> (uint8_t bCmd, uint16_t bData)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a83c2cd62a99e98f92bca6087e19e9b28">USBHwCmdRead</a> (uint8_t bCmd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a2bda7e218ce22938dd36831009cb6814">USBHwEPRealize</a> (int idx, uint16_t wMaxPSize)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a1768d559ac6621755d8d6caa0231da99">USBHwEPEnable</a> (int idx, <a class="el" href="lpc23xx-types_8h.html#a3e5b8192e7d9ffaf3542f1210aec18dd">BOOL</a> fEnable)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#ab167fa9e51d9aff898267a3d725e1cdf">USBHwEPConfig</a> (uint8_t bEP, uint16_t wMaxPacketSize)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a9f3e00c2bf7009e71038a744f3f35988">USBHwRegisterEPIntHandler</a> (uint8_t bEP, <a class="el" href="usbapi_8h.html#ac8a0e9862c9d79376bfe13a1744e1619">TFnEPIntHandler</a> *pfnHandler)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#acb6cdbd30764f387eb33b8e62ab0afa6">USBHwRegisterDevIntHandler</a> (<a class="el" href="usbapi_8h.html#a413d15bfc3a6a92962aa7b94e76b19be">TFnDevIntHandler</a> *pfnHandler)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a1e0e4a449cf9334f86b813a31345c3b0">USBHwRegisterFrameHandler</a> (<a class="el" href="usbapi_8h.html#a389798da2555938068d1281c7cc7c8a4">TFnFrameHandler</a> *pfnHandler)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a5260cca88c4cb64342a3e738d72e1b00">USBHwSetAddress</a> (uint8_t bAddr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a539f89b5ac053db030cb222aac269e50">USBHwConnect</a> (<a class="el" href="lpc23xx-types_8h.html#a3e5b8192e7d9ffaf3542f1210aec18dd">BOOL</a> fConnect)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a0e9e9eb8d6b275018b826d7de3bb0742">USBHwNakIntEnable</a> (uint8_t bIntBits)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a028fdf8607b359667b3d786d2653b8e6">USBHwEPGetStatus</a> (uint8_t bEP)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#af5e6c325dad9d16c29e9b2e30ad9ff86">USBHwEPStall</a> (uint8_t bEP, <a class="el" href="lpc23xx-types_8h.html#a3e5b8192e7d9ffaf3542f1210aec18dd">BOOL</a> fStall)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a95c5600336da84ef01cb8d1b73e3254f">USBHwEPWrite</a> (uint8_t bEP, uint8_t *pbBuf, int <a class="el" href="usbcontrol_8c.html#a5107428870ffb7eeaedd654d10e86916">iLen</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a66c0d57f739ea7586b077c7a671fa7fc">USBHwEPRead</a> (uint8_t bEP, uint8_t *pbBuf, int iMaxLen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#ad996a4e3503838e37a679356424e488a">USBHwISOCEPRead</a> (const uint8_t bEP, uint8_t *pbBuf, const int iMaxLen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#acb24f45e62a6a4818cebb3738d9b3399">USBHwConfigDevice</a> (<a class="el" href="lpc23xx-types_8h.html#a3e5b8192e7d9ffaf3542f1210aec18dd">BOOL</a> fConfigured)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a6f1d4fe24123509bb7e6164c6826a08e">USBHwISR</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="lpc23xx-types_8h.html#a3e5b8192e7d9ffaf3542f1210aec18dd">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a1dfca6c758c755918d5bc1be85cdac51">USBHwInit</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#adb1ba9cfc103929e0d4c3650de12a5f2">USBSetupDMADescriptor</a> (volatile uint32_t dmaDescriptor[], volatile uint32_t nextDdPtr[], const uint8_t isIsocFlag, const uint16_t maxPacketSize, const uint16_t dmaLengthIsocNumFrames, void *dmaBufferStartAddress, uint32_t *isocPacketSizeMemoryAddress)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#aaefad7bcf2757d2d14480eb47c3ae043">USBDisableDMAForEndpoint</a> (const uint8_t bEndpointNumber)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a9e3db3c09a078d5c3314511f516f841e">USBEnableDMAForEndpoint</a> (const uint8_t bEndpointNumber)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#ab96ae1aab0cfe2649b7b001011eb3ca7">USBInitializeISOCFrameArray</a> (uint32_t isocFrameArr[], const uint32_t numElements, const uint16_t startFrameNumber, const uint16_t defaultFrameLength)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a76a79fd3eeafb0df5a93c41bd57c6ace">USBSetHeadDDForDMA</a> (const uint8_t bEp, volatile uint32_t *udcaHeadArray[32], volatile const uint32_t *dmaDescriptorPtr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a7c432746ed6a6c07b5c9ffebad92e00d">USBInitializeUSBDMA</a> (volatile uint32_t *udcaHeadArray[32])</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="usbapi_8h.html#a413d15bfc3a6a92962aa7b94e76b19be">TFnDevIntHandler</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a46edab504be061f5193d420ef59dcf17">_pfnDevIntHandler</a> = NULL</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="usbapi_8h.html#ac8a0e9862c9d79376bfe13a1744e1619">TFnEPIntHandler</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a2ada373dd9af22859c59cf4a31e2fd8f">_apfnEPIntHandlers</a> [16]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="usbapi_8h.html#a389798da2555938068d1281c7cc7c8a4">TFnFrameHandler</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="usbhw__lpc_8c.html#a185e3bfbbba3dca684e4cc1eefbdc67a">_pfnFrameHandler</a> = NULL</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>USB hardware layer </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a3eaf046a4008f5e987d369949ada44bf"></a><!-- doxytag: member="usbhw_lpc.c::DEBUG_LED_INIT" ref="a3eaf046a4008f5e987d369949ada44bf" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_LED_INIT</td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">x</td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>LED initialisation macro </p>

</div>
</div>
<a class="anchor" id="ae0c331b0f232393b6ac7b5c4194cf1c7"></a><!-- doxytag: member="usbhw_lpc.c::DEBUG_LED_ON" ref="ae0c331b0f232393b6ac7b5c4194cf1c7" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_LED_ON</td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">x</td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>turn LED on </p>

</div>
</div>
<a class="anchor" id="a73b1055927a84310c708efeb0165480b"></a><!-- doxytag: member="usbhw_lpc.c::DEBUG_LED_OFF" ref="a73b1055927a84310c708efeb0165480b" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_LED_OFF</td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">x</td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>turn LED off </p>

</div>
</div>
<a class="anchor" id="a00ae1ba9be3cc10583f6d81776b9fd4e"></a><!-- doxytag: member="usbhw_lpc.c::EP2IDX" ref="a00ae1ba9be3cc10583f6d81776b9fd4e" args="(bEP)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EP2IDX</td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">bEP</td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;((((bEP)&amp;0xF)&lt;&lt;1)|(((bEP)&amp;0x80)&gt;&gt;7))</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>convert from endpoint address to endpoint index </p>

</div>
</div>
<a class="anchor" id="a998d2a16b853abfa50f30cc0c53ddd38"></a><!-- doxytag: member="usbhw_lpc.c::IDX2EP" ref="a998d2a16b853abfa50f30cc0c53ddd38" args="(idx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IDX2EP</td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">idx</td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;((((idx)&lt;&lt;7)&amp;0x80)|(((idx)&gt;&gt;1)&amp;0xF))</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>convert from endpoint index to endpoint address </p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a9cd85ad2f851492776a4ea5b67e8a9b9"></a><!-- doxytag: member="usbhw_lpc.c::Wait4DevInt" ref="a9cd85ad2f851492776a4ea5b67e8a9b9" args="(uint32_t dwIntr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void Wait4DevInt </td>
          <td>(</td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>dwIntr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Local function to wait for a device interrupt (and clear it)</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dwIntr</em>&nbsp;</td><td>Bitmask of interrupts to wait for </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="af661719c467f8b57cd220e6344e9ee33"></a><!-- doxytag: member="usbhw_lpc.c::USBHwCmd" ref="af661719c467f8b57cd220e6344e9ee33" args="(uint8_t bCmd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void USBHwCmd </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bCmd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Local function to send a command to the USB protocol engine</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bCmd</em>&nbsp;</td><td>Command to send </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a56473a98d7755138ab78b81ea95c1070"></a><!-- doxytag: member="usbhw_lpc.c::USBHwCmdWrite" ref="a56473a98d7755138ab78b81ea95c1070" args="(uint8_t bCmd, uint16_t bData)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void USBHwCmdWrite </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bCmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>bData</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Local function to send a command + data to the USB protocol engine</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bCmd</em>&nbsp;</td><td>Command to send </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bData</em>&nbsp;</td><td>Data to send </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a83c2cd62a99e98f92bca6087e19e9b28"></a><!-- doxytag: member="usbhw_lpc.c::USBHwCmdRead" ref="a83c2cd62a99e98f92bca6087e19e9b28" args="(uint8_t bCmd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static uint8_t USBHwCmdRead </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bCmd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Local function to send a command to the USB protocol engine and read data</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bCmd</em>&nbsp;</td><td>Command to send</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the data </dd></dl>

</div>
</div>
<a class="anchor" id="a2bda7e218ce22938dd36831009cb6814"></a><!-- doxytag: member="usbhw_lpc.c::USBHwEPRealize" ref="a2bda7e218ce22938dd36831009cb6814" args="(int idx, uint16_t wMaxPSize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void USBHwEPRealize </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>wMaxPSize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>'Realizes' an endpoint, meaning that buffer space is reserved for it. An endpoint needs to be realised before it can be used.</p>
<p>From experiments, it appears that a USB reset causes USBReEp to re-initialise to 3 (= just the control endpoints). However, a USB bus reset does not disturb the USBMaxPSize settings.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>idx</em>&nbsp;</td><td>Endpoint index </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>wMaxPSize</em>&nbsp;</td><td>Maximum packet size for this endpoint </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a1768d559ac6621755d8d6caa0231da99"></a><!-- doxytag: member="usbhw_lpc.c::USBHwEPEnable" ref="a1768d559ac6621755d8d6caa0231da99" args="(int idx, BOOL fEnable)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void USBHwEPEnable </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lpc23xx-types_8h.html#a3e5b8192e7d9ffaf3542f1210aec18dd">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>fEnable</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Enables or disables an endpoint</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>idx</em>&nbsp;</td><td>Endpoint index </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fEnable</em>&nbsp;</td><td>TRUE to enable, FALSE to disable </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ab167fa9e51d9aff898267a3d725e1cdf"></a><!-- doxytag: member="usbhw_lpc.c::USBHwEPConfig" ref="ab167fa9e51d9aff898267a3d725e1cdf" args="(uint8_t bEP, uint16_t wMaxPacketSize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBHwEPConfig </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bEP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>wMaxPacketSize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Configures an endpoint and enables it</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bEP</em>&nbsp;</td><td>Endpoint number </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>wMaxPacketSize</em>&nbsp;</td><td>Maximum packet size for this EP </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a9f3e00c2bf7009e71038a744f3f35988"></a><!-- doxytag: member="usbhw_lpc.c::USBHwRegisterEPIntHandler" ref="a9f3e00c2bf7009e71038a744f3f35988" args="(uint8_t bEP, TFnEPIntHandler *pfnHandler)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBHwRegisterEPIntHandler </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bEP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="usbapi_8h.html#ac8a0e9862c9d79376bfe13a1744e1619">TFnEPIntHandler</a> *&nbsp;</td>
          <td class="paramname"> <em>pfnHandler</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Registers an endpoint event callback</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bEP</em>&nbsp;</td><td>Endpoint number </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pfnHandler</em>&nbsp;</td><td>Callback function </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="acb6cdbd30764f387eb33b8e62ab0afa6"></a><!-- doxytag: member="usbhw_lpc.c::USBHwRegisterDevIntHandler" ref="acb6cdbd30764f387eb33b8e62ab0afa6" args="(TFnDevIntHandler *pfnHandler)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBHwRegisterDevIntHandler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="usbapi_8h.html#a413d15bfc3a6a92962aa7b94e76b19be">TFnDevIntHandler</a> *&nbsp;</td>
          <td class="paramname"> <em>pfnHandler</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Registers an device status callback</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pfnHandler</em>&nbsp;</td><td>Callback function </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a1e0e4a449cf9334f86b813a31345c3b0"></a><!-- doxytag: member="usbhw_lpc.c::USBHwRegisterFrameHandler" ref="a1e0e4a449cf9334f86b813a31345c3b0" args="(TFnFrameHandler *pfnHandler)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBHwRegisterFrameHandler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="usbapi_8h.html#a389798da2555938068d1281c7cc7c8a4">TFnFrameHandler</a> *&nbsp;</td>
          <td class="paramname"> <em>pfnHandler</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Registers the frame callback</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pfnHandler</em>&nbsp;</td><td>Callback function </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a5260cca88c4cb64342a3e738d72e1b00"></a><!-- doxytag: member="usbhw_lpc.c::USBHwSetAddress" ref="a5260cca88c4cb64342a3e738d72e1b00" args="(uint8_t bAddr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBHwSetAddress </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bAddr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sets the USB address.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bAddr</em>&nbsp;</td><td>Device address to set </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a539f89b5ac053db030cb222aac269e50"></a><!-- doxytag: member="usbhw_lpc.c::USBHwConnect" ref="a539f89b5ac053db030cb222aac269e50" args="(BOOL fConnect)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBHwConnect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="lpc23xx-types_8h.html#a3e5b8192e7d9ffaf3542f1210aec18dd">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>fConnect</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Connects or disconnects from the USB bus</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fConnect</em>&nbsp;</td><td>If TRUE, connect, otherwise disconnect </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a0e9e9eb8d6b275018b826d7de3bb0742"></a><!-- doxytag: member="usbhw_lpc.c::USBHwNakIntEnable" ref="a0e9e9eb8d6b275018b826d7de3bb0742" args="(uint8_t bIntBits)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBHwNakIntEnable </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bIntBits</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Enables interrupt on NAK condition</p>
<p>For IN endpoints a NAK is generated when the host wants to read data from the device, but none is available in the endpoint buffer. For OUT endpoints a NAK is generated when the host wants to write data to the device, but the endpoint buffer is still full.</p>
<p>The endpoint interrupt handlers can distinguish regular (ACK) interrupts from NAK interrupt by checking the bits in their bEPStatus argument.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bIntBits</em>&nbsp;</td><td>Bitmap indicating which NAK interrupts to enable </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a028fdf8607b359667b3d786d2653b8e6"></a><!-- doxytag: member="usbhw_lpc.c::USBHwEPGetStatus" ref="a028fdf8607b359667b3d786d2653b8e6" args="(uint8_t bEP)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t USBHwEPGetStatus </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bEP</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Gets the status from a specific endpoint.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bEP</em>&nbsp;</td><td>Endpoint number </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Endpoint status byte (containing EP_STATUS_xxx bits) </dd></dl>

</div>
</div>
<a class="anchor" id="af5e6c325dad9d16c29e9b2e30ad9ff86"></a><!-- doxytag: member="usbhw_lpc.c::USBHwEPStall" ref="af5e6c325dad9d16c29e9b2e30ad9ff86" args="(uint8_t bEP, BOOL fStall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBHwEPStall </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bEP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lpc23xx-types_8h.html#a3e5b8192e7d9ffaf3542f1210aec18dd">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>fStall</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sets the stalled property of an endpoint</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bEP</em>&nbsp;</td><td>Endpoint number </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fStall</em>&nbsp;</td><td>TRUE to stall, FALSE to unstall </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a95c5600336da84ef01cb8d1b73e3254f"></a><!-- doxytag: member="usbhw_lpc.c::USBHwEPWrite" ref="a95c5600336da84ef01cb8d1b73e3254f" args="(uint8_t bEP, uint8_t *pbBuf, int iLen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int USBHwEPWrite </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bEP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>pbBuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>iLen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Writes data to an endpoint buffer</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bEP</em>&nbsp;</td><td>Endpoint number </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pbBuf</em>&nbsp;</td><td>Endpoint data </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>iLen</em>&nbsp;</td><td>Number of bytes to write</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>number of bytes written into the endpoint buffer </dd></dl>

</div>
</div>
<a class="anchor" id="a66c0d57f739ea7586b077c7a671fa7fc"></a><!-- doxytag: member="usbhw_lpc.c::USBHwEPRead" ref="a66c0d57f739ea7586b077c7a671fa7fc" args="(uint8_t bEP, uint8_t *pbBuf, int iMaxLen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int USBHwEPRead </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>bEP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>pbBuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>iMaxLen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reads data from an endpoint buffer</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bEP</em>&nbsp;</td><td>Endpoint number </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pbBuf</em>&nbsp;</td><td>Endpoint data </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>iMaxLen</em>&nbsp;</td><td>Maximum number of bytes to read</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the number of bytes available in the EP (possibly more than iMaxLen), or &lt;0 in case of error. </dd></dl>

</div>
</div>
<a class="anchor" id="ad996a4e3503838e37a679356424e488a"></a><!-- doxytag: member="usbhw_lpc.c::USBHwISOCEPRead" ref="ad996a4e3503838e37a679356424e488a" args="(const uint8_t bEP, uint8_t *pbBuf, const int iMaxLen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int USBHwISOCEPRead </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&nbsp;</td>
          <td class="paramname"> <em>bEP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>pbBuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>iMaxLen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="acb24f45e62a6a4818cebb3738d9b3399"></a><!-- doxytag: member="usbhw_lpc.c::USBHwConfigDevice" ref="acb24f45e62a6a4818cebb3738d9b3399" args="(BOOL fConfigured)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBHwConfigDevice </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="lpc23xx-types_8h.html#a3e5b8192e7d9ffaf3542f1210aec18dd">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>fConfigured</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sets the 'configured' state.</p>
<p>All registered endpoints are 'realised' and enabled, and the 'configured' bit is set in the device status register.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fConfigured</em>&nbsp;</td><td>If TRUE, configure device, else unconfigure </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a6f1d4fe24123509bb7e6164c6826a08e"></a><!-- doxytag: member="usbhw_lpc.c::USBHwISR" ref="a6f1d4fe24123509bb7e6164c6826a08e" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBHwISR </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>USB interrupt handler</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Get all 11 bits of frame number instead of just 8</dd></dl>
<p>Endpoint interrupts are mapped to the slow interrupt </p>

</div>
</div>
<a class="anchor" id="a1dfca6c758c755918d5bc1be85cdac51"></a><!-- doxytag: member="usbhw_lpc.c::USBHwInit" ref="a1dfca6c758c755918d5bc1be85cdac51" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lpc23xx-types_8h.html#a3e5b8192e7d9ffaf3542f1210aec18dd">BOOL</a> USBHwInit </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialises the USB hardware</p>
<p>This function assumes that the hardware is connected as shown in section 10.1 of the LPC2148 data sheet: P0.31 controls a switch to connect a 1.5k pull-up to D+ if low. P0.23 is connected to USB VCC.</p>
<p>Embedded artists board: make sure to disconnect P0.23 LED as it acts as a pull-up and so prevents detection of USB disconnect.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>TRUE if the hardware was successfully initialised </dd></dl>

</div>
</div>
<a class="anchor" id="adb1ba9cfc103929e0d4c3650de12a5f2"></a><!-- doxytag: member="usbhw_lpc.c::USBSetupDMADescriptor" ref="adb1ba9cfc103929e0d4c3650de12a5f2" args="(volatile uint32_t dmaDescriptor[], volatile uint32_t nextDdPtr[], const uint8_t isIsocFlag, const uint16_t maxPacketSize, const uint16_t dmaLengthIsocNumFrames, void *dmaBufferStartAddress, uint32_t *isocPacketSizeMemoryAddress)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBSetupDMADescriptor </td>
          <td>(</td>
          <td class="paramtype">volatile uint32_t&nbsp;</td>
          <td class="paramname"> <em>dmaDescriptor</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">volatile uint32_t&nbsp;</td>
          <td class="paramname"> <em>nextDdPtr</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&nbsp;</td>
          <td class="paramname"> <em>isIsocFlag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&nbsp;</td>
          <td class="paramname"> <em>maxPacketSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&nbsp;</td>
          <td class="paramname"> <em>dmaLengthIsocNumFrames</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>dmaBufferStartAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&nbsp;</td>
          <td class="paramname"> <em>isocPacketSizeMemoryAddress</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function is used to setup and populated the various elements of a LPC2148 DMA desccriptor such that after calling this function, the DMA descriptor could be used as part of a DMA tranfer.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dmaDescriptor</em>&nbsp;</td><td>A pointer to a 4 or 5 element long array of uint32_t's that the DMA descriptor data is to be stored into, it should point to some place in DMA RAM. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nextDdPtr</em>&nbsp;</td><td>The value to be placed in the "Next_DD_Pointer" value of the DMA desriptor, set to NULL if there is no next-pointer. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>isIsocFlag</em>&nbsp;</td><td>Flag to indicate if this DMA descriptor is for an ISOC endpoint (with a 5 element dmaDescriptor array pointer), 1 indicates ISOC, 0 indicates non-ISOC. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>maxPacketSize</em>&nbsp;</td><td>The maximum packet size that can be sent/received for the endpoint in question. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dmaLengthIsocNumFrames</em>&nbsp;</td><td>For non-ISOC endpoints, the number of bytes in the buffer to be transfered, for ISOC endpoints, the number of frames to be transfered. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dmaBufferStartAddress</em>&nbsp;</td><td>Start address for the dma transfer (location to store data for an OUT endpoint, location to pull data from for an IN endpoint), it should point to some place in DMA RAM. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>isocPacketSizeMemoryAddress</em>&nbsp;</td><td>If a non-ISOC endpoint, set this to NULL, if an ISOC endpoint, then set this to a pointer to an array of uint32_t's that represent how</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>void </dd></dl>

</div>
</div>
<a class="anchor" id="aaefad7bcf2757d2d14480eb47c3ae043"></a><!-- doxytag: member="usbhw_lpc.c::USBDisableDMAForEndpoint" ref="aaefad7bcf2757d2d14480eb47c3ae043" args="(const uint8_t bEndpointNumber)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBDisableDMAForEndpoint </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&nbsp;</td>
          <td class="paramname"> <em>bEndpointNumber</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function disables DMA for the endpoint indicated by the paramater.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bEndpointNumber</em>&nbsp;</td><td>the endpoint number to be disabled.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>void </dd></dl>

</div>
</div>
<a class="anchor" id="a9e3db3c09a078d5c3314511f516f841e"></a><!-- doxytag: member="usbhw_lpc.c::USBEnableDMAForEndpoint" ref="a9e3db3c09a078d5c3314511f516f841e" args="(const uint8_t bEndpointNumber)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBEnableDMAForEndpoint </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&nbsp;</td>
          <td class="paramname"> <em>bEndpointNumber</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Enables DMA for a particular endpoint.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bEndpontNumber</em>&nbsp;</td><td>The endpoint to to enable DMA for.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd></dd></dl>

</div>
</div>
<a class="anchor" id="ab96ae1aab0cfe2649b7b001011eb3ca7"></a><!-- doxytag: member="usbhw_lpc.c::USBInitializeISOCFrameArray" ref="ab96ae1aab0cfe2649b7b001011eb3ca7" args="(uint32_t isocFrameArr[], const uint32_t numElements, const uint16_t startFrameNumber, const uint16_t defaultFrameLength)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBInitializeISOCFrameArray </td>
          <td>(</td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>isocFrameArr</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint32_t&nbsp;</td>
          <td class="paramname"> <em>numElements</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&nbsp;</td>
          <td class="paramname"> <em>startFrameNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&nbsp;</td>
          <td class="paramname"> <em>defaultFrameLength</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function is used to initialized an ISOC frame array</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>[in|out]</em>&nbsp;</td><td>isocFrameArr The array of ISOC frame descriptors to be set, it should point to some place in DMA RAM. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>numElements</em>&nbsp;</td><td>The number of elements in the isocFrameArr array. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>startFrameNumber</em>&nbsp;</td><td>Number to start at for numbering each frame. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>defaultFrameLength</em>&nbsp;</td><td>The frame length to set all the frame descriptors to.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>void </dd></dl>

</div>
</div>
<a class="anchor" id="a76a79fd3eeafb0df5a93c41bd57c6ace"></a><!-- doxytag: member="usbhw_lpc.c::USBSetHeadDDForDMA" ref="a76a79fd3eeafb0df5a93c41bd57c6ace" args="(const uint8_t bEp, volatile uint32_t *udcaHeadArray[32], volatile const uint32_t *dmaDescriptorPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBSetHeadDDForDMA </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&nbsp;</td>
          <td class="paramname"> <em>bEp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">volatile uint32_t *&nbsp;</td>
          <td class="paramname"> <em>udcaHeadArray</em>[32], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">volatile const uint32_t *&nbsp;</td>
          <td class="paramname"> <em>dmaDescriptorPtr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function is used to set the DMA descriptor head for the linked list of a particular endpoint.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bEp</em>&nbsp;</td><td>The endpoint number to set the DMA linked list head for. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>[in|out]</em>&nbsp;</td><td>udcaHeadArray The array of pointers that point to the head DD elements for each endpoint, it should point to some place in DMA RAM. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>[in|out]</em>&nbsp;</td><td>dmaDescriptorPtr The address of the DMA descriptor that is to be the new head, it should point to some place in DMA RAM.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd></dd></dl>

</div>
</div>
<a class="anchor" id="a7c432746ed6a6c07b5c9ffebad92e00d"></a><!-- doxytag: member="usbhw_lpc.c::USBInitializeUSBDMA" ref="a7c432746ed6a6c07b5c9ffebad92e00d" args="(volatile uint32_t *udcaHeadArray[32])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBInitializeUSBDMA </td>
          <td>(</td>
          <td class="paramtype">volatile uint32_t *&nbsp;</td>
          <td class="paramname"> <em>udcaHeadArray</em>[32]</td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function is used to initialize the USB DMA controller</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>[in|out]</em>&nbsp;</td><td>udcaHeadArray This is a pointer to the array of DMA descriptor linked-list head pointers, it should point to some place in DMA RAM.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd></dd></dl>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a46edab504be061f5193d420ef59dcf17"></a><!-- doxytag: member="usbhw_lpc.c::_pfnDevIntHandler" ref="a46edab504be061f5193d420ef59dcf17" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="usbapi_8h.html#a413d15bfc3a6a92962aa7b94e76b19be">TFnDevIntHandler</a>* <a class="el" href="usbhw__lpc_8c.html#a46edab504be061f5193d420ef59dcf17">_pfnDevIntHandler</a> = NULL<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Installed device interrupt handler </p>

</div>
</div>
<a class="anchor" id="a2ada373dd9af22859c59cf4a31e2fd8f"></a><!-- doxytag: member="usbhw_lpc.c::_apfnEPIntHandlers" ref="a2ada373dd9af22859c59cf4a31e2fd8f" args="[16]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="usbapi_8h.html#ac8a0e9862c9d79376bfe13a1744e1619">TFnEPIntHandler</a>* <a class="el" href="usbhw__lpc_8c.html#a2ada373dd9af22859c59cf4a31e2fd8f">_apfnEPIntHandlers</a>[16]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Installed endpoint interrupt handlers </p>

</div>
</div>
<a class="anchor" id="a185e3bfbbba3dca684e4cc1eefbdc67a"></a><!-- doxytag: member="usbhw_lpc.c::_pfnFrameHandler" ref="a185e3bfbbba3dca684e4cc1eefbdc67a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="usbapi_8h.html#a389798da2555938068d1281c7cc7c8a4">TFnFrameHandler</a>* <a class="el" href="usbhw__lpc_8c.html#a185e3bfbbba3dca684e4cc1eefbdc67a">_pfnFrameHandler</a> = NULL<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Installed frame interrupt handlers </p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Fri Aug 26 2011 13:17:58 for liblpc23xx by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
